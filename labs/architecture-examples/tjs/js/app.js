// Generated by CoffeeScript 1.7.1
(function() {
  var router, todosView,
    __slice = [].slice;

  this.todos = FreeMart.request('todos:load', 'todos');

  Busbup.subscribe(TODOS_CHANGED, function() {
    return FreeMart.request('todos:save', 'todos', todos);
  });

  watch(this, 'todos', (function() {
    return Busbup.publish(TODOS_CHANGED);
  }), 1);

  todosView = new TodosView(todos);

  todosView.render({
    inside: '#todoapp'
  });

  FreeMart.register('/', function() {
    return todosView.filterBy('all');
  });

  FreeMart.register('/:filter', function(_, filter) {
    return todosView.filterBy(filter);
  });

  FreeMart.register(/\/.*/, function() {
    var options, rest, result;
    options = arguments[0], rest = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    console.log("Before " + options.key);
    result = FreeMart.request.apply(FreeMart, [options.key].concat(__slice.call(rest)));
    console.log("After " + options.key);
    return result;
  });

  console.log(FreeMart);

  router = new routes();

  router.get('/', function() {
    return FreeMart.request('/');
  });

  router.get('/:filter', function(req) {
    return FreeMart.request('/:filter', req.params.filter);
  });

}).call(this);
