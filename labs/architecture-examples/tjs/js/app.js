// Generated by CoffeeScript 1.7.1
(function() {
  var getTodos, isValidFilter, router, showTodos, todos, todosView;

  todos = void 0;

  getTodos = function() {
    if (!todos) {
      todos = TodosResource.load('todos');
      todos.subscribe(CHANGED, function() {
        return TodosResource.save('todos', todos);
      });
    }
    return todos;
  };

  todosView = void 0;

  showTodos = function(todos, filter) {
    if (todosView) {
      return Busbup.publish(FILTER, filter);
    } else {
      todosView = TodosView({
        todos: todos,
        filter: filter
      });
      return todosView.render({
        inside: '#todoapp'
      });
    }
  };

  isValidFilter = function(filter) {
    return ['all', 'active', 'completed'].indexOf(filter) >= 0;
  };

  router = new routes();

  router.get('/', function() {
    return showTodos(getTodos(), 'all');
  });

  router.get('/:filter', function(req) {
    var filter;
    filter = req.params.filter;
    if (isValidFilter(filter)) {
      return showTodos(getTodos(), filter);
    } else {
      return console.log("Filter is not supported: '" + filter + "'");
    }
  });

  if (location.hash === "") {
    window.location.hash = "#/";
  }

}).call(this);
